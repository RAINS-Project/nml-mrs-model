@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#>.
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.
@prefix xsd: <http://www.w3.org/2001/XMLSchema#>.
@prefix owl: <http://www.w3.org/2002/07/owl#>.
@prefix nml: <http://schemas.ogf.org/nml/2013/03/base#>.
@prefix mrs: <http://schemas.ogf.org/mrs/2013/12/topology#>.

<http://www.maxgigapop.net/mrs/2014/04/app-view-1#> 
    a owl:Ontology;
    rdfs:label "Example MAX hybrid cloud app view".


# need a macro-template script/language to define and instantiate reusable statement blocks


# 1. VPC subnet in AWS with DirectConnect

<urn:ogf:network:rains.maxgigapop.net:2014:aws>
    a   nml:Topology;
    nml:hasService <urn:ogf:network:rains.maxgigapop.net:2014:aws:ec2>;
    nml:hasTopology
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1>.

<urn:ogf:network:rains.maxgigapop.net:2014:aws:ec2>
    a   mrs:HypervisorService;
    mrs:providesVM
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:vm1>,
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:vm2>.

<urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1>
    a   nml:Topology;
    nml:hasService
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:subnet1>,
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:routing-table1>;
    nml:hasNode
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:vm1>,
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:vm2>;
    nml:hasBidirectionalPort
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:igw1>,
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:vgw1>.

<urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:subnet1>
    a   nml:SwitchingService;
    nml:encoding <http://schemas.ogf.org/nml/2012/10/ethernet#vlan>;
    nml:labelSwapping "false";
    nml:hasBidirectionalPort
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:vm1:eth0>,
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:vm2:eth0>,
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:igw1>,
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:vgw1>.

# route to public Internet
<urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:igw1>
    a   nml:BidirectionalPort;
    nml:hasService [
        a   mrs:RoutingService;
        mrs:providesRoute [
            a   mrs:Route;
            mrs:prefix "0.0.0.0/0";
            mrs:nextHop [
                a   mrs:Address;
                mrs:prefix "0.0.0.0/0"]]].

<urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:vgw1>
    a   nml:BidirectionalPort;
    nml:hasLabel [
            a   nml:Label;
            nml:labeltype <http://schemas.ogf.org/nml/2012/10/ethernet#vlan>;
            nml:values ""];
    nml:isAlias
        <urn:ogf:network:rains.maxgigapop.net:2014:ipnet:routing-service1:max:rtr-eqix:dc-10g1>.

<urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:routing-table1>
    a   mrs:RoutingService;
    mrs:providesRoute 
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:routing-table1:local-route>,
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:routing-table1:subnet1-route-to-vgw1>,
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:routing-table1:subnet1-route-to-igw1>.

<urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:routing-table1:local-route>
    a   mrs:Route;
    mrs:prefix "10.0.0.0/16";
    mrs:nextHop [
            a   mrs:Address;
            mrs:prefix "10.0.0.0/16"].

<urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:routing-table1:subnet1-route-to-vgw1>
    a   mrs:Route;
    mrs:prefix "192.168.0.0/16";
    mrs:nextHop <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:vgw1>.

<urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:routing-table1:subnet1-route-to-igw1>
    a   mrs:Route;
    mrs:prefix "0.0.0.0/0";
    mrs:nextHop <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:igw1>.

<urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:vm1>
    a   nml:Node;
    nml:hasBidirectionalPort
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:vm1:eth0>.

<urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:vm1:eth0>
    a   nml:BidirectionalPort;
    nml:hasService [
            a   mrs:RoutingService;
            mrs:localAddress "dhcp:10.0.0.0/16+elastic-ip:*"].

<urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:vm2>
    a   nml:Node;
    nml:hasBidirectionalPort
        <urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:vm2:eth0>.

<urn:ogf:network:rains.maxgigapop.net:2014:app-view-1:aws:vpc-1:vm2:eth0>
    a   nml:BidirectionalPort;
    nml:hasService [
            a   mrs:RoutingService;
            mrs:localAddress "dhcp:10.0.0.0/16+elastic-ip:*"].



# 2. MAX L3 Network
# 2.1. max:rtr-eqix:dc-10g1 DirectConnect port
# 2.2. Routes for DC-AWS, MSX Cloud 
# 2.3. Optional: Ceph storage server

<urn:ogf:network:rains.maxgigapop.net:2014:ipnet>
    a   nml:Topology;
    nml:hasBidirectionalPort
#        <urn:ogf:network:rains.maxgigapop.net:2014:ipnet:clpk-t640:xe-6-0-0>,
#        <urn:ogf:network:rains.maxgigapop.net:2014:ipnet:clpk-t640:xe-7-1-0>,
#        <urn:ogf:network:rains.maxgigapop.net:2014:ipnet:clpk-t640:xe-7-2-0>;
        <urn:ogf:network:rains.maxgigapop.net:2014:ipnet:max:rtr-eqix:dc-10g1>;
    nml:hasService <urn:ogf:network:rains.maxgigapop.net:2014:ipnet:routing-service1>.


# 10G port to MSX
#<urn:ogf:network:rains.maxgigapop.net:2014:ipnet:clpk-t640:xe-6-0-0>
#    a   nml:BidirectionalPort;
#    nml:hasLabelGroup [
#            a   nml:LabelGroup;
#            nml:labeltype <http://schemas.ogf.org/nml/2012/10/ethernet#vlan>;
#            nml:values ""];
#    nml:isAlias <urn:ogf:network:rains.maxgigapop.net:2014:msx:nexus-5k:6>.

## 10G port to Storage Server
#<urn:ogf:network:rains.maxgigapop.net:2014:ipnet:clpk-t640:xe-7-1-0>
#    a   nml:BidirectionalPort.

## 10G port to MSX SDX-VM1
#<urn:ogf:network:rains.maxgigapop.net:2014:ipnet:clpk-t640:xe-7-2-0>
#    a   nml:BidirectionalPort.


# IPNet L3 routing service
<urn:ogf:network:rains.maxgigapop.net:2014:ipnet:routing-service1>
    a   mrs:RoutingService;
    mrs:providesRoute 
#        <urn:ogf:network:rains.maxgigapop.net:2014:ipnet:routing-service1:local>,
        <urn:ogf:network:rains.maxgigapop.net:2014:ipnet:routing-service1:to-aws>,
        <urn:ogf:network:rains.maxgigapop.net:2014:ipnet:routing-service1:to-msx>.

#<urn:ogf:network:rains.maxgigapop.net:2014:ipnet:routing-service1:local>
#    a   mrs:Route;
#    mrs:prefix "206.196.176.0/22";
#    mrs:nextHop [
#            a   mrs:Address;
#            mrs:prefix "206.196.176.0/22"].

<urn:ogf:network:rains.maxgigapop.net:2014:ipnet:routing-service1:to-aws>
    a   mrs:Route;
    mrs:prefix "10.0.0.0/16";
    mrs:nextHop <urn:ogf:network:rains.maxgigapop.net:2014:ipnet:max:rtr-eqix:dc-10g1>.

<urn:ogf:network:rains.maxgigapop.net:2014:ipnet:routing-service1:to-msx>
    a   mrs:Route;
    mrs:prefix "192.168.0.0/16";
    mrs:nextHop <urn:ogf:network:rains.maxgigapop.net:2014:msx>.

## Ceph storage resource description


# 3. MAX MSX Cloud
# 3.1. A VM with OVS port and SR-IOV (label #sriov untagged --> +sublevel-port if VLAN tagged) L2 and L3 ports

<urn:ogf:network:rains.maxgigapop.net:2014:msx>
    a   nml:Topology;
    nml:hasNode
        <urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-vm1>;
    nml:hasService
        <urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-datanet2>.


<urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-vm1>
    a   nml:Node;
    nml:hasBidirectionalPort
        <urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-vm1:eth0>,
        <urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-vm1:sriov>;
    nml:hasService <urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-vm1:routing-table1>.

# OVS port (will be routed through existing pipes in OS-View / non-sriov & in-cloud route constraint)
<urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-vm1:eth0>
    a   nml:BidirectionalPort;
    nml:hasService [
            a   mrs:RoutingService;
            mrs:localAddress "dhcp:*+floating-ip:*"].

# SR-IOV pool
<urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-vm1:sriov>
    a   nml:BidirectionalPort;
    nml:hasLabelGroup [
            a   nml:LabelGroup;
            nml:labeltype <http://schemas.ogf.org/mrs/2013/12/sriov#ethernet>];
    nml:hasBidirectionalPort 
        <urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-vm1:eth1>,
        <urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-vm1:eth2>.


# port to MAX IpNet (will be routed through existing pipes in OS-View / sriov & static route constraint)
# OS-View may add SwitchingService to create new L2 pipe SR-IOV--VM-FEX--FI--Nexus
<urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-vm1:eth1>
    a   nml:BidirectionalPort;
    nml:hasService [
            a   mrs:RoutingService;
            mrs:localAddress "static:*"
            mrs:providesRoute
                [   a   mrs:Route;
                    mrs:prefix "0.0.0.0/0";
                    mrs:nextHop <urn:ogf:network:rains.maxgigapop.net:2014:ipnet>]].

# SR-IOV port to L2 WAN
<urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-vm1:eth2>
    a   nml:BidirectionalPort;
    nml:hasLabelGroup [
            a   nml:LabelGroup;
            nml:labeltype <http://schemas.ogf.org/nml/2012/10/ethernet#vlan>;
            nml:values ""];
    nml:hasService [
            a   mrs:RoutingService;
            mrs:localAddress "192.168.0.1/24"].

# L2 connect SDX-VM to ION
<urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-datanet2>
    a   nml:SwitchingService;
    nml:encoding <http://schemas.ogf.org/nml/2012/10/ethernet#vlan>;
    nml:labelSwapping "false";
    nml:hasBidirectionalPort
        <urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-vm1:eth2>,
        <urn:ogf:network:domain=ion.internet2.edu:node=rtr.newy:port=xe-0-1-0:link=*>.

# L3 routes within the SDX-VM
<urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-vm1:routing-table1>
    a   mrs:RoutingService;
    mrs:providesRoute 
        [   a   mrs:Route;
            mrs:prefix "10.0.0.0/16";
            mrs:nextHop <urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-vm1:eth1>],
        [   a   mrs:Route;
            mrs:prefix "192.169.0.0/16";
            mrs:nextHop <urn:ogf:network:rains.maxgigapop.net:2014:msx:sdx-vm1:eth2>].

## add VpnService route through msx:sdx-vm1:eth1

# 4. L2 and L3 WAN does not show up in initial app view


# 5. Tenant Site

<urn:ogf:network:tenant1.org:2014:topology>
    a   nml:Topology;
    nml:hasBidirectionalPort
        <urn:ogf:network:tenant1.org:2014:topology:site1:port1>;
    nml:hasService
        <urn:ogf:network:tenant1.org:2014:topology:datanet1>,
        <urn:ogf:network:tenant1.org:2014:topology:routing-service1>.

<urn:ogf:network:tenant1.org:2014:topology:site1:port1>
    a   nml:BidirectionalPort;
    nml:hasLabelGroup [
            a   nml:LabelGroup;
            nml:labeltype <http://schemas.ogf.org/nml/2012/10/ethernet#vlan>;
            nml:values "2001"];
    nml:hasService [
            a   mrs:RoutingService;
            mrs:localAddress "192.168.0.2/24"].

<urn:ogf:network:tenant1.org:2014:topology:datanet1>
    a   nml:SwitchingService;
    nml:encoding <http://schemas.ogf.org/nml/2012/10/ethernet#vlan>;
    nml:labelSwapping "false";
    nml:hasBidirectionalPort
        <urn:ogf:network:tenant1.org:2014:topology:site1:port1>,
        <urn:ogf:network:domain=ion.internet2.edu:node=rtr.newy:port=xe-0-1-0:link=*>.

<urn:ogf:network:tenant1.org:2014:topology:routing-service1>
    a   mrs:RoutingService;
    mrs:providesRoute 
        [   a   mrs:Route;
            mrs:prefix "10.0.0.0/16";
            mrs:nextHop <urn:ogf:network:tenant1.org:2014:topology:site1:port1>],
        [   a   mrs:Route;
            mrs:prefix "192.169.0.0/16";
            mrs:nextHop [
            a   mrs:Address;
            mrs:prefix "192.169.0.0/16"]].



